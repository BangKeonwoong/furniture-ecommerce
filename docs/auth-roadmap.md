# Auth Feature Roadmap — 2025-03-17

## 1. 준비 및 설계
- [x] 요구사항 확정: 이메일 기반 회원가입/로그인, SNS 로그인 여부, 비밀번호 재설정 범위 정리.
- [x] UX 플로우 정의: 로그인 → 장바구니/결제 연계, 회원가입 성공 후 리디렉션 경로(예: `/account`).
- [ ] 보안 정책 확정: 비밀번호 최소 길이, 복잡도, 잠금 정책, rate limit, 감사 로그 범위.
- [ ] 개인정보/약관 처리 지침 정리: 마케팅 동의, 계정 삭제 플로우, 개인정보 보관 기간.

## 2. 데이터 모델 및 Prisma 스키마
- [x] `User`/`Session`/`VerificationToken` 모델 필드 정의
  - User: `id`, `email`(unique), `passwordHash`, `name`, `marketingOptIn`, `createdAt`, `updatedAt`, `deletedAt?`
  - Session: `id`, `userId`, `expiresAt`, `userAgent`, `ipAddress`, `createdAt` (서버 세션 테이블)
  - VerificationToken: `id`, `userId`, `token`, `type`("PASSWORD_RESET" | "EMAIL_VERIFY"), `expiresAt`, `consumedAt?`
- [ ] Prisma 마이그레이션 생성 및 샌드박스 DB 반영.
- [ ] Seed 데이터 업데이트(테스트 계정 1~2개).

## 3. 서버 로직
- [ ] 비밀번호 해시 및 검증 유틸 (`bcrypt` or `argon2`) 도입.
- [ ] `POST /api/auth/signup`, `POST /api/auth/login`, `POST /api/auth/logout` 라우트 설계.
- [ ] 세션 관리 선택: NextAuth vs 커스텀 JWT/세션 스토어 → 결정 후 구현.
- [ ] CSRF 방어(쿠키 SameSite, anti-CSRF 토큰), rate limiting, 브루트포스 방지 적용.
- [ ] 감사 로그(로그인 실패/성공) 및 관측용 메트릭 정의.
- [ ] 이메일 검증/비밀번호 재설정 토큰 로직(후속 단계로 분리 가능).

## 4. 프런트엔드 UI
- [ ] `/signup`, `/login` 페이지 및 폼 컴포넌트 생성.
- [ ] 오류/성공 상태 처리, 로딩 스피너, 접근성 검증.
- [ ] 로그인 상태에 따른 헤더 CTA (로그인/로그아웃/마이페이지) 분기.

## 5. 라우팅 및 접근 제어
- [ ] 보호된 페이지(`account/*`, 추후 주문 내역 등)에 인증 가드 적용.
- [ ] 인증 실패 시 리디렉션/알림 UX 정의.
- [ ] 서버 액션 (예: 결제)에서 사용자 식별 정보 사용하도록 확장.

## 6. 테스트 및 QA
- [ ] 비즈니스 로직 단위 테스트 (해시, 세션 생성 등) + 실패 케이스(잘못된 비밀번호, 잠금 상태, 토큰 만료).
- [ ] Playwright 플로우: 회원가입 → 로그인 → 보호 페이지 접근 + 로그아웃/재로그인/리디렉션 시나리오.
- [ ] 보안 점검 체크리스트(OWASP 기반) 초안 작성.
- [ ] 퍼포먼스/부하 테스트로 rate limit, 세션 스토어 안정성 검토.

## 7. 배포 및 운영
- [ ] `.env`에 비밀키, 세션 시크릿, SMTP 자격증명 추가.
- [ ] 운영 로그/모니터링(로그인 실패 추적, 알림) 구성.
- [ ] 문서화: 운영팀을 위한 계정 관리 가이드, 비밀번호 정책 안내.
- [ ] 장애 대응 플레이북(로그인 불가, 메일 발송 실패)을 마련하고 온콜 대상 공유.

## 8. 컴플라이언스 및 사용자 권리
- [ ] 개인정보 처리방침/이용약관에 회원 데이터 수집·활용 항목 반영.
- [ ] 계정 삭제/탈퇴 플로우 및 데이터 삭제 정책 정의.
- [ ] 이메일 수신 동의, 마케팅 동의 등 체크박스 UX 및 저장 로직 추가.
- [ ] SNS 로그인 도입 시, 각 플랫폼 개발자 센터 정책 준수 검토.
